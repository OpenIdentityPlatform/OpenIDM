<?xml version="1.0" encoding="UTF-8"?>
<!--
  The contents of this file are subject to the terms of the Common Development and
  Distribution License (the License). You may not use this file except in compliance with the
  License.

  You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
  specific language governing permission and limitations under the License.

  When distributing Covered Software, include this CDDL Header Notice in each file and include
  the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
  Header, with the fields enclosed by brackets [] replaced by your own identifying
  information: "Portions Copyrighted [year] [name of copyright owner]".

  Copyright (c) 2011 ForgeRock AS. All rights reserved.
-->
<assembly xmlns="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2 http://maven.apache.org/xsd/assembly-1.1.2.xsd">
    <id>bin</id>
    <baseDirectory>/</baseDirectory>
    <formats>
        <format>zip</format>
    </formats>
    <fileSets>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <outputDirectory>/openidm</outputDirectory>
            <excludes>
                <exclude>**/*.sh</exclude>
                <exclude>**/*.command</exclude>
                <exclude>**/*.bat</exclude>
                <exclude>**/internal-common/**</exclude>
            </excludes>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <outputDirectory>/openidm</outputDirectory>
            <fileMode>754</fileMode>
            <includes>
                <include>**/*.sh</include>
                <include>**/*.command</include>
            </includes>
            <filtered>true</filtered>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <outputDirectory>/openidm</outputDirectory>
            <fileMode>754</fileMode>
            <includes>
                <include>**/*.bat</include>
            </includes>
            <lineEnding>windows</lineEnding>
            <filtered>true</filtered>
        </fileSet>
        <fileSet>
            <directory>${project.build.directory}/orientstudio/orientdb-${orientdb.version}/www</directory>
            <outputDirectory>/openidm/db/util/orientdb/studio</outputDirectory>
        </fileSet>
        <!-- Create empty logs directory  -->
        <fileSet>
        	<directory>${project.build.directory}</directory>
            <excludes>
    			<exclude>**/*</exclude>
  			</excludes>
            <outputDirectory>/openidm/logs</outputDirectory>
        </fileSet>
        <!-- Setup Sample1  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-ldap.json</exclude>
                <exclude>data/Example.ldif</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample1</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <outputDirectory>/openidm/samples/sample1</outputDirectory>
        </fileSet>
        <!-- Setup Sample2  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <outputDirectory>/openidm/samples/sample2</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample2</outputDirectory>
        </fileSet>
        <!-- Setup Sample2b  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <outputDirectory>/openidm/samples/sample2b</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample2b</outputDirectory>
        </fileSet>
        <!-- Setup Sample2c  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <outputDirectory>/openidm/samples/sample2c</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample2c</outputDirectory>
        </fileSet>
        <!-- Setup Sample2d  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample2d</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample2d</outputDirectory>
        </fileSet>
        <!-- Setup Sample3  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/provisioner.openicf-ldap.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
                <exclude>data/Example.ldif</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample3</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample3</outputDirectory>
        </fileSet>
        <!-- Setup Sample4  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/provisioner.openicf-ldap.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
                <exclude>data/Example.ldif</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample4</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample4</outputDirectory>
        </fileSet>
        <!-- Setup Sample5  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/provisioner.openicf-ldap.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
                <exclude>data/Example.ldif</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample5</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample5</outputDirectory>
        </fileSet>
        <!-- Setup Sample6  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/provisioner.openicf-ldap.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
                <exclude>data/Example.ldif</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample6</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample6</outputDirectory>
        </fileSet>
        <!-- Setup Sample7  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/provisioner.openicf-ldap.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
                <exclude>data/Example.ldif</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample7</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample7</outputDirectory>
        </fileSet>
        <!-- Setup Sample8  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/provisioner.openicf-ldap.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
                <exclude>data/Example.ldif</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample8</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample8</outputDirectory>
        </fileSet>
        <!-- Setup Sample9  -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/provisioner.openicf-ldap.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
                <exclude>data/Example.ldif</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample9</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources</directory>
            <includes>
                <include>conf/**</include>
                <include>script/**</include>
            </includes>
            <excludes>
                <exclude>conf/provisioner.openicf-xml.json</exclude>
                <exclude>conf/schedule-reconcile_systemXmlAccounts_managedUser.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/sample9</outputDirectory>
        </fileSet>
        <!-- Setup workflow sample -->
        <fileSet>
            <directory>${basedir}/src/main/resources/samples/internal-common</directory>
            <includes>
                <include>conf/workflow.json</include>
            </includes>
            <outputDirectory>/openidm/samples/workflow</outputDirectory>
        </fileSet>
        <fileSet>
            <directory>${basedir}/src/main/resources/conf</directory>
            <includes>
                <include>**</include>
            </includes>
            <excludes>
                <exclude>managed.json</exclude>
                <exclude>process-access.json</exclude>
                <exclude>provisioner.openicf-xml.json</exclude>
                <exclude>sync.json</exclude>
                <exclude>ui-configuration.json</exclude>
            </excludes>
            <outputDirectory>/openidm/samples/workflow/conf</outputDirectory>
        </fileSet>
    </fileSets>
    <dependencySets>
        <dependencySet>
            <useProjectArtifact>false</useProjectArtifact>
            <outputDirectory>/openidm/bundle</outputDirectory>
            <scope>runtime</scope>
            <excludes>
                <exclude>org.apache.felix:org.apache.felix.framework</exclude>
                <exclude>org.osgi:*</exclude>
                <exclude>org.forgerock.openicf.connectors:*</exclude>
                <exclude>org.forgerock.openidm:openidm-shell</exclude>
                <exclude>org.forgerock.openidm:openidm-ui-ria*</exclude>
                <exclude>org.forgerock.openidm:openidm-workflow-activiti:**:jar-with-dependencies</exclude>
                <exclude>org.forgerock.openidm:openidm-workflow-remote</exclude>
                <exclude>org.apache.felix:*gogo*</exclude>
                <exclude>*:*:js</exclude>
                <exclude>*:*:zip</exclude>
                <!--exclude>org.apache.felix:org.apache.felix.scr.annotations</exclude>
                <exclude>javax.persistence:persistence-api</exclude>
                <exclude>javax.transaction:jta</exclude>
                <exclude>org.apache.felix:org.apache.felix.main</exclude>
                <exclude>org.apache.felix:org.osgi.foundation</exclude>
                <exclude>net.sf.kxml:kxml2</exclude>
                <exclude>xmlpull:xmlpull</exclude-->
            </excludes>
        </dependencySet>
        <!-- Include UI in distribution for use in various web servers -->
        <dependencySet>
        	<unpack>true</unpack>
            <outputDirectory>/openidm/ui</outputDirectory>
            <includes>
                <include>org.forgerock.openidm:openidm-ui-ria-admin</include>
            </includes>
        </dependencySet>
        <dependencySet>
            <useProjectArtifact>false</useProjectArtifact>
            <outputDirectory>/openidm/connectors</outputDirectory>
            <includes>
                <include>org.forgerock.openicf.connectors:*-connector</include>
            </includes>
        </dependencySet>
        <dependencySet>
            <unpack>false</unpack>
            <outputFileNameMapping>felix.jar</outputFileNameMapping>
            <includes>
                <include>org.apache.felix:org.apache.felix.framework</include>
            </includes>
            <outputDirectory>/openidm/bin</outputDirectory>
        </dependencySet>
        <dependencySet>
            <unpack>false</unpack>
            <outputFileNameMapping>openidm.jar</outputFileNameMapping>
            <includes>
                <include>org.forgerock.openidm:openidm-shell</include>
            </includes>
            <outputDirectory>/openidm/bin</outputDirectory>
        </dependencySet>
        <dependencySet>
            <unpack>false</unpack>
            <includes>
                <include>org.apache.felix:org.apache.felix.gogo.runtime</include>
                <include>org.apache.felix:org.apache.felix.gogo.shell</include>
            </includes>
            <outputDirectory>/openidm/bin</outputDirectory>
        </dependencySet>
        <dependencySet>
            <outputDirectory>/openidm/bin/workflow</outputDirectory>
            <includes>
                <include>org.forgerock.openidm:openidm-workflow-activiti:**:jar-with-dependencies</include>
                <include>org.forgerock.openidm:openidm-workflow-remote</include>
            </includes>
        </dependencySet>
        <dependencySet>
            <unpack>true</unpack>
            <outputDirectory>/openidm/</outputDirectory>
            <includes>
                <include>org.forgerock.commons:launcher-zip:zip:*</include>
            </includes>
            <unpackOptions>
                <includes>
                    <include>bin/**</include>
                </includes>
            </unpackOptions>
        </dependencySet>
    </dependencySets>
</assembly>
