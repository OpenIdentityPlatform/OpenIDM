# Extend Postgres to be used as an OpenIDM repo
# See https://hub.docker.com/_/postgres/


FROM postgres:9.6

ENV OPENIDM_VERSION 5.0.0-SNAPSHOT
ENV TMP_PG /tmp/openidm/db/postgresql/scripts

COPY maven/openidm-zip-$OPENIDM_VERSION.zip openidm-$OPENIDM_VERSION.zip

RUN buildDeps=' \
       	unzip \
    	' \
    && set -x \
	&& apt-get update && apt-get install -y --no-install-recommends $buildDeps \
	&& rm -rf /var/lib/apt/lists/* \
	&& unzip -qq -d /tmp/ openidm-$OPENIDM_VERSION.zip \
	&& cp $TMP_PG/openidm.pgsql /docker-entrypoint-initdb.d/01_init.sql \
	&& cp $TMP_PG/default_schema_optimization.pgsql /docker-entrypoint-initdb.d/02_optimize.sql \
	&& cp $TMP_PG/activiti.postgres.create.*.sql /docker-entrypoint-initdb.d/ \
	&& rm openidm-$OPENIDM_VERSION.zip \
	&& rm -r /tmp/openidm