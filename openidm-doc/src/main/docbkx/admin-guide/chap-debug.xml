<?xml version="1.0" encoding="UTF-8"?>
<!--
  ! CCPL HEADER START
  !
  ! This work is licensed under the Creative Commons
  ! Attribution-NonCommercial-NoDerivs 3.0 Unported License.
  ! To view a copy of this license, visit
  ! http://creativecommons.org/licenses/by-nc-nd/3.0/
  ! or send a letter to Creative Commons, 444 Castro Street,
  ! Suite 900, Mountain View, California, 94041, USA.
  !
  ! You can also obtain a copy of the license at
  ! legal/CC-BY-NC-ND.txt.
  ! See the License for the specific language governing permissions
  ! and limitations under the License.
  !
  ! If applicable, add the following below this CCPL HEADER, with the fields
  ! enclosed by brackets "[]" replaced with your own identifying information:
  !      Portions Copyright [yyyy] [name of copyright owner]
  !
  ! CCPL HEADER END
  !
  !      Copyright 2011-2012 ForgeRock AS
  !    
-->
<chapter xml:id='chap-debug'
 xmlns='http://docbook.org/ns/docbook'
 version='5.0' xml:lang='en'
 xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
 xsi:schemaLocation='http://docbook.org/ns/docbook http://docbook.org/xml/5.0/xsd/docbook.xsd'
 xmlns:xlink='http://www.w3.org/1999/xlink'
 xmlns:xinclude='http://www.w3.org/2001/XInclude'>
 <title>Debugging OpenIDM Scripts</title>

 <para>OpenIDM includes Eclipse JSDT libraries so you can use Eclipse to debug
 you OpenIDM scripts during development.</para>

 <procedure xml:id="enable-debugging">
  <title>To Enable Debugging</title>

  <para>Follow these steps to enable debugging using Eclipse.</para>

  <step>
   <para>Install the environment to support JavaScript development in either
   of the following ways.</para>
   <stepalternatives>
    <step>
     <para>Download and install Eclipse IDE for JavaScript Web Developers
     from the <link xlink:href="http://www.eclipse.org/downloads/"
     xlink:show="new">Eclipse download page</link>.</para>
    </step>
    <step>
     <para>Add <link xlink:href="http://wiki.eclipse.org/JSDT" xlink:show="new"
     >JavaScript Development Tools</link> to your existing Eclipse
     installation.</para>
    </step>
   </stepalternatives>
  </step>
  <step>
   <para>Create an empty JavaScript project called <literal>External JavaScript
   Source</literal> in Eclipse.</para>
   <para>Eclipse then uses the <filename>External JavaScript Source</filename>
   directory in the default workspace location to store sources that it
   downloads from OpenIDM.</para>
  </step>
  <step>
   <para>Stop OpenIDM.</para>
  </step>
  <step>
   <para>Edit <filename>openidm/conf/boot/boot.properties</filename> to
   enable debugging.</para>
   <substeps>
    <step>
     <para>Uncomment and edit the following line.</para>
     <programlisting language="none" width="84">
#openidm.script.javascript.debug=transport=socket,suspend=y,address=9888,trace=true</programlisting>
     <para>Here <literal>suspend=y</literal> prevents OpenIDM from starting
     until the remote JavaScript debugger has connected. You might therefore
     choose to set this to <literal>suspend=n</literal>.</para>
    </step>
    <step>
     <para>Uncomment and edit the following line.</para>
     <programlisting language="none" width="81">
#openidm.script.javascript.sources=/Eclipse/workspace/External JavaScript Source/</programlisting>
     <para> Adjust <literal>/Eclipse/workspace/External JavaScript
     Source/</literal> to match the absolute path to this folder including the
     trailing <literal>/</literal> character. On Windows, also use forward
     slashes, such as <literal>C:/Eclipse/workspace/External JavaScript
     Source/</literal>.</para>
     <para>Each time OpenIDM loads a new script, it then creates or overwrites
     the file in the <filename>External JavaScript Source</filename> directory.
     Before toggling breakpoints, be sure to refresh the source manually in
     Eclipse so you have the latest version.</para>
    </step>
   </substeps>
  </step>
  <step>
   <para>Start OpenIDM, and connect the debugger.</para>
  </step>
 </procedure>
</chapter>
