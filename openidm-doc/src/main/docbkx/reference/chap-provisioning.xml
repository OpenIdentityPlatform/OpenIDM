<?xml version="1.0" encoding="UTF-8"?>
<!--
  ! CCPL HEADER START
  !
  ! This work is licensed under the Creative Commons
  ! Attribution-NonCommercial-NoDerivs 3.0 Unported License.
  ! To view a copy of this license, visit
  ! http://creativecommons.org/licenses/by-nc-nd/3.0/
  ! or send a letter to Creative Commons, 444 Castro Street,
  ! Suite 900, Mountain View, California, 94041, USA.
  !
  ! You can also obtain a copy of the license at
  ! legal/CC-BY-NC-ND.txt.
  ! See the License for the specific language governing permissions
  ! and limitations under the License.
  !
  ! If applicable, add the following below this CCPL HEADER, with the fields
  ! enclosed by brackets "[]" replaced with your own identifying information:
  !      Portions Copyright [yyyy] [name of copyright owner]
  !
  ! CCPL HEADER END
  !
  !      Copyright 2011 ForgeRock AS
  !    
-->
<chapter xml:id='chap-provisioning'
 xmlns='http://docbook.org/ns/docbook'
 version='5.0' xml:lang='en'
 xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
 xsi:schemaLocation='http://docbook.org/ns/docbook http://docbook.org/xml/5.0/xsd/docbook.xsd'
 xmlns:xlink='http://www.w3.org/1999/xlink'
 xmlns:xinclude='http://www.w3.org/2001/XInclude'>
 <title>Provisioning</title>

 <para>This chapter describes provisioning service configuration.</para>

 <section xml:id="connector-info-provider-conf">
  <title>Connector Info Provider Service</title>

  <para>The connector info provider service takes this configuration.</para>
<programlisting language="javascript">
{
  "connectorsLocation"     : <replaceable>string</replaceable>,
  "remoteConnectorServers" : [<replaceable>remoteConnectorServer objects</replaceable>]
}</programlisting>

  <variablelist>
   <varlistentry>
    <term>connectorsLocation</term>
    <listitem>
     <para>string, optional</para>
     <para>Specifies the directory where OpenICF connectors are located. The
     default location is <filename>connectors</filename>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>remoteConnectorServers</term>
    <listitem>
     <para>array of RemoteConnectorServer objects, optional</para>
     <para>A list of remote connector servers managed by this service.</para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>The following example shows a <literal>remoteConnectorServer</literal>
  object configuration.</para>

  <programlisting language="javascript">{
  "name"          : "testServer",
  "host"          : "127.0.0.1",
  "port"          : 8759,
  "useSSL"        : false,
  "timeout"       : 0,
  "key"           : "Passw0rd",
  "trustManagers" :
    [
       "X509TrustManager",
       "BlindTrustManager"
    ]
}</programlisting>

 <variablelist xml:id="remote-connector-server-object-properties">
  <title>Remote Connector Server Object Properties</title>
  <para>OpenIDM supports the following remote connector server object
  properties.</para>
  <varlistentry>
   <term>name</term>
   <listitem>
    <para>string, required</para>
    <para>The name of the remote connector server object. Used to identify the
    remote connector server in connector reference object.</para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>host</term>
   <listitem>
    <para>string, required</para>
    <para>Remote host to connect to.</para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>port</term>
   <listitem>
    <para>string, optional</para>
    <para>
     Remote port to connect to. Default value: 8759</para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>useSSL</term>
   <listitem>
    <para>boolean, optional</para>
    <para>Specifies to use or not SSL to connect. Default value:
    <literal>false</literal></para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>timeout</term>
   <listitem>
    <para>integer, optional</para>
    <para>Specifies the timeout (in milliseconds) to use for the connection.
    Default value: 0</para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>key</term>
   <listitem>
    <para>string, required</para>
    <para>The secret key to use to authenticate to the remote connector
    server.</para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term>trustManagers</term>
   <listitem>
    <para>not specified</para>
    <para>Not implemented yet. The service uses the default JVM
    <literal>TrustManager</literal>.</para>
   </listitem>
  </varlistentry>
 </variablelist>
 </section>

 <section xml:id="openicf-provisioner-conf">
  <title>OpenICF Provisioner Service</title>

  <para>The following example shows an OpenICF provisioner service
  configuration.</para>

  <programlisting language="javascript">{
 "name"                    : "xml",
 "connectorRef"            : null,
 "poolConfigOption"        : null,
 "operationTimeout"        : null,
 "configurationProperties" : null,
 "objectTypes"             : null,
 "operationOptions"        : null
}</programlisting>

  <variablelist xml:id="connector-reference-properties">
   <title>Connector Reference Properties</title>
   <para>The following example shows a connector reference object.</para>
   <programlisting language="javascript">{
  "bundleName"       : "org.forgerock.openicf.connectors.file.xml",
  "bundleVersion"    : "1.1.0.0-SNAPSHOT",
  "connectorName"    : "com.forgerock.openicf.xml.XMLConnector",
  "connectorHostRef" : "host"
}</programlisting>
   <varlistentry>
    <term>bundleName</term>
    <listitem>
     <para>string, required</para>
     <para>The <replaceable>ConnectorBundle-Name</replaceable> of the OpenICF
     connector.</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>bundleVersion</term>
    <listitem>
     <para>string, required</para>
     <para>The <replaceable>ConnectorBundle-Version</replaceable> of the
     OpenICF connector.</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>connectorName</term>
    <listitem>
     <para>string, required</para>
     <para>The Connector implementation class name.</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>connectorHostRef</term>
    <listitem>
     <para>string, optional</para>
     <para>The name of the RemoteConnectorServer object.</para>
    </listitem>
   </varlistentry>
  </variablelist>
  <variablelist xml:id="pool-configuration-option-properties">
   <title>Pool Configuration Option Properties</title>
   <para>The following example shows a pool configuration object.</para>

   <programlisting language="javascript">{
  "maxObjects"                 : 10,
  "maxIdle"                    : 10,
  "maxWait"                    : 150000,
  "minEvictableIdleTimeMillis" : 120000,
  "minIdle"                    : 1
}</programlisting>

   <varlistentry>
    <term>maxObjects</term>
    <listitem>
     <para>TODO</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>maxIdle</term>
    <listitem>
     <para>TODO</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>maxWait</term>
    <listitem>
     <para>TODO</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>minEvictableIdleTimeMillis</term>
    <listitem>
     <para>TODO</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>minIdle</term>
    <listitem>
     <para>TODO</para>
    </listitem>
   </varlistentry>
  </variablelist>
  <variablelist xml:id="operation-timeout-properties">
   <title>Operation Timeout Properties</title>
   <para>This configuration sets the timeout of the operations.</para>

   <programlisting language="javascript">{
  "CREATE"              : -1,
  "TEST"                : -1,
  "AUTHENTICATE"        : -1,
  "SEARCH"              : -1,
  "VALIDATE"            : -1,
  "GET"                 : -1,
  "UPDATE"              : -1,
  "DELETE"              : -1,
  "SCRIPT_ON_CONNECTOR" : -1,
  "SCRIPT_ON_RESOURCE"  : -1,
  "SYNC"                : -1,
  "SCHEMA"              : -1
}</programlisting>
   <varlistentry>
    <term><replaceable>operation-name</replaceable></term>
    <listitem>
     <para>TODO</para>
    </listitem>
   </varlistentry>
  </variablelist>
  <variablelist xml:id="configuration-properties">
   <title>Configuration Properties</title>
   <para>The following example shows a configuration properties object.</para>

   <programlisting language="javascript">TODO</programlisting>

   <varlistentry>
    <term>TODO</term>
    <listitem>
     <para>TODO</para>
    </listitem>
   </varlistentry>
  </variablelist>
  <variablelist xml:id="object-types-properties">
   <title>Object Types Properties</title>
   <para>This configuration object specifies the supported object types. The
   property name defines the <literal>objectType</literal> used in the
   URI: <literal>system/$<replaceable >systemName</replaceable>/$<replaceable
   >objectType</replaceable></literal></para>
   <para>The configuration is based on <link xlink:show="new"
   xlink:href="http://tools.ietf.org/html/draft-zyp-json-schema-03">JSON
   Schema</link> with extensions described below.</para>

   <programlisting language="javascript">{
  "account" :
  {
    "$schema" : "http://json-schema.org/draft-03/schema",
    "id" : "__ACCOUNT__",
    "type" : "object",
    "nativeType" : "__ACCOUNT__",
    "properties" :
    {
      "name" :
      {
        "type" : "string",
        "nativeName" : "__NAME__",
        "nativeType" : "JAVA_TYPE_PRIMITIVE_LONG",
        "flags" :
        [
          "NOT_CREATABLE",
          "NOT_UPDATEABLE",
          "NOT_READABLE",
          "NOT_RETURNED_BY_DEFAULT"
        ]
      },
      "groups" :
      {
        "type" : "array",
        "items" :
        {
          "type" : "string",
          "nativeType" : "string"
        },
        "nativeName" : "__GROUPS__",
        "nativeType" : "string",
        "flags" :
        [
          "NOT_RETURNED_BY_DEFAULT"
        ]
      }
    }
  }
}</programlisting>

   <varlistentry>
    <term>Object Level Extensions</term>
    <listitem>
     <variablelist>
      <varlistentry>
       <term>nativeType</term>
       <listitem>
        <para>string, optional</para>
        <para>The native OpenICF object type.</para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Property Level Extensions</term>
    <listitem>
     <variablelist>
      <varlistentry>
       <term>nativeType</term>
       <listitem>
        <para>string, optional</para>
        <para>The native OpenICF attribute type.</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>nativeName</term>
       <listitem>
        <para>string, optional</para>
        <para>The native OpenICF attribute name.</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>flags</term>
       <listitem>
        <para>string, optional</para>
        <para>The native OpenICF attribute flags. The 
        <replaceable>required</replaceable> and
        <replaceable>multivalued</replaceable> flags are defined by the JSON
        schema.</para>
        <literallayout class="monospaced"
        ><replaceable>required</replaceable> = <literal
        >"required" : true</literal></literallayout>
        <literallayout class="monospaced"
        ><replaceable>multivalued</replaceable> = <literal
        >"type" : "array"</literal></literallayout>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>

  <variablelist xml:id="operation-options-properties">
   <title>Operation Options Properties</title>

   <para>Operation options define how to act on specified operations.</para>

   <programlisting language="javascript">{
  "SYNC" :
  {
    "denied" : true,
    "onDeny" : "DO_NOTHING",
    "objectFeatures" :
    {
      "__ACCOUNT__" :
      {
        "denied" : true,
        "onDeny" : "THROW_EXCEPTION",
        "operationOptionInfo" :
        {
          "$schema" : "http://json-schema.org/draft-03/schema",
          "id" : "FIX_ME",
          "type" : "object",
          "properties" :
          {
            "_OperationOption-float" :
            {
               "type" : "number",
               "nativeType" : "JAVA_TYPE_PRIMITIVE_FLOAT"
            }
          }
        }
      },
      "__GROUP__" :
      {
        "denied" : false,
        "onDeny" : "DO_NOTHING"
      }
    }
  }
}</programlisting>

   <varlistentry>
    <term>denied</term>
    <listitem>
     <para>boolean, optional</para>
     <para>This property prevents operation execution if the value is
     <literal>true</literal>.</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>onDeny</term>
    <listitem>
     <para>string, optional</para>
     <para>If <literal>denied</literal> is <literal>true</literal>, then the
     service uses this value. Default value:
     <literal>DO_NOTHING</literal>.</para>
     <itemizedlist>
      <listitem>
       <para><literal>DO_NOTHING</literal>: On operation the service does
       nothing.</para>
      </listitem>
      <listitem>
       <para><literal>THROW_EXCEPTION</literal>: On operation the service
       throws a  <literal>ForbiddenException</literal> exception.</para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
  </variablelist>
 </section>

 <section xml:id="java-type-glossary">
  <title>Java Type Glossary</title>

  <para>The OpenICF Framework supports the following Java types, but the JSON
  representation uses only <code>String</code>, <code>boolean</code>,
  <code>Number</code>, <code>null</code>, <code>List</code>, and
  <code>Map</code> types. The service uses this glossary to convert back and
  forth between the different types.</para>

<!--
  typeMap.put(Constants.TYPE_ANY, Object.class);
  typeMap.put(Constants.TYPE_ARRAY, List.class);
  typeMap.put(Constants.TYPE_BOOLEAN, Boolean.class);
  typeMap.put(Constants.TYPE_INTEGER, Integer.class);
  typeMap.put(Constants.TYPE_NUMBER, Number.class);
  typeMap.put(Constants.TYPE_OBJECT, Map.class);
  typeMap.put(Constants.TYPE_STRING, String.class);
  typeMap.put(JAVA_TYPE_BIGDECIMAL, BigDecimal.class);
  typeMap.put(JAVA_TYPE_BIGINTEGER, BigInteger.class);
  typeMap.put(JAVA_TYPE_PRIMITIVE_BOOLEAN, boolean.class);
  typeMap.put(JAVA_TYPE_BYTE_ARRAY, byte[].class);
  typeMap.put(JAVA_TYPE_CHAR, char.class);
  typeMap.put(JAVA_TYPE_CHARACTER, Character.class);
  typeMap.put(JAVA_TYPE_DATE, Date.class);
  typeMap.put(JAVA_TYPE_PRIMITIVE_DOUBLE, double.class);
  typeMap.put(JAVA_TYPE_DOUBLE, Double.class);
  typeMap.put(JAVA_TYPE_FILE, File.class);
  typeMap.put(JAVA_TYPE_PRIMITIVE_FLOAT, float.class);
  typeMap.put(JAVA_TYPE_FLOAT, Float.class);
  typeMap.put(JAVA_TYPE_GUARDEDBYTEARRAY, GuardedByteArray.class);
  typeMap.put(JAVA_TYPE_GUARDEDSTRING, GuardedString.class);
  typeMap.put(JAVA_TYPE_INT, int.class);
  typeMap.put(JAVA_TYPE_PRIMITIVE_LONG, long.class);
  typeMap.put(JAVA_TYPE_LONG, Long.class);
  typeMap.put(JAVA_TYPE_NAME, Name.class);
  typeMap.put(JAVA_TYPE_OBJECTCLASS, ObjectClass.class);
  typeMap.put(JAVA_TYPE_QUALIFIEDUID, QualifiedUid.class);
  typeMap.put(JAVA_TYPE_SCRIPT, Script.class);
  typeMap.put(JAVA_TYPE_UID, Uid.class);
  typeMap.put(JAVA_TYPE_URI, URI.class);
-->

  <itemizedlist xml:id="glossary-java-types">
   <title>Java Types</title>
   <listitem>
    <para><literal>JAVA_TYPE_URI</literal>: TODO provide definition.</para>
   </listitem>
  </itemizedlist>

  <itemizedlist xml:id="glossary-operations">
   <title>Operations</title>
   <listitem>
    <para><literal>AUTHENTICATE</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/AuthenticationApiOp.html"
    >AuthenticationApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>CREATE</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/CreateApiOp.html"
    >CreateApiOp</link></para>
   </listitem>
  <listitem>
    <para><literal>DELETE</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/DeleteApiOp.html"
    >DeleteApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>GET</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/GetApiOp.html"
    >GetApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>RESOLVEUSERNAME</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ResolveUsernameApiOp.html"
    >ResolveUsernameApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>SCHEMA</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SchemaApiOp.html"
    >SchemaApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>SCRIPT_ON_CONNECTOR</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ScriptOnConnectorApiOp.html"
    >ScriptOnConnectorApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>SCRIPT_ON_RESOURCE</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ScriptOnResourceApiOp.html"
    >ScriptOnResourceApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>SEARCH</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SearchApiOp.html"
    >SearchApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>SYNC</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SyncApiOp.html"
    >SyncApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>TEST</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/TestApiOp.html"
    >TestApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>UPDATE</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/UpdateApiOp.html"
    >UpdateApiOp</link></para>
   </listitem>
   <listitem>
    <para><literal>VALIDATE</literal>: <link xlink:show="new"
    xlink:href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ValidateApiOp.html"
    >ValidateApiOp</link></para>
   </listitem>
  </itemizedlist>
 </section>
</chapter>
